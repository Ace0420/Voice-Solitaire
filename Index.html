<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voice Solitaire - Accessible Card Game</title>
  <style>
    body { font-family: sans-serif; background: #111827; color: #fff; margin: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
    .container { max-width: 420px; width: 100%; margin-top: 3em; padding: 2em; background: #222; border-radius: 1em; box-shadow: 0 0 24px #0007; }
    .center { text-align: center; }
    .btn { background: #22c55e; color: #fff; font-size: 1.2em; padding: 0.8em 2em; border: none; border-radius: 0.5em; margin: 1em 0; cursor: pointer; }
    .btn:active { background: #16a34a; }
    .status { margin: 1em 0; font-size: 1.1em; }
    .pile { margin: 1em 0; }
    .hidden { display: none; }
    .msg { background: #1f2937; padding: 1em; border-radius: 0.5em; margin-bottom: 1em; }
    .instructions { color: #9ca3af; font-size: 1em; margin-top: 1em; }
    @media (max-width: 480px) { .container { padding: 1em; } }
  </style>
</head>
<body>
  <div class="container" id="main">
    <h1 class="center">Voice Solitaire</h1>
    <div id="msg" class="msg center">Say "start game" or tap Start. Say "help" anytime.</div>
    <button id="startBtn" class="btn" aria-label="Start Game">Start</button>
    <div id="status" class="status center hidden"></div>
    <div id="board" class="hidden">
      <div id="stock" class="pile"></div>
      <div id="waste" class="pile"></div>
      <div id="foundations" class="pile"></div>
      <div id="tableau" class="pile"></div>
      <button id="drawBtn" class="btn" aria-label="Draw Card">Draw Card</button>
      <button id="undoBtn" class="btn" aria-label="Undo">Undo</button>
      <button id="describeBtn" class="btn" aria-label="Describe Board">Describe</button>
    </div>
    <div class="instructions center">
      Voice commands: "start game", "draw card", "move card", "undo", "describe board", "save game", "quit game", "help"
    </div>
  </div>
  <audio id="click-sound" src="click.mp3" preload="auto"></audio>
  <audio id="error-sound" src="error.mp3" preload="auto"></audio>
  <script>
    // Minimal Solitaire state
    let deck = [], stock = [], waste = [], foundations = [[],[],[],[]], tableau = [[],[],[],[],[],[],[]];
    let score = 0, undosLeft = 5, gameInProgress = false, history = [];
    const suits = ['hearts', 'diamonds', 'clubs', 'spades'];
    const values = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

    // UI elements
    const startBtn = document.getElementById('startBtn');
    const msg = document.getElementById('msg');
    const status = document.getElementById('status');
    const boardEl = document.getElementById('board');
    const stockEl = document.getElementById('stock');
    const wasteEl = document.getElementById('waste');
    const foundationsEl = document.getElementById('foundations');
    const tableauEl = document.getElementById('tableau');
    const drawBtn = document.getElementById('drawBtn');
    const undoBtn = document.getElementById('undoBtn');
    const describeBtn = document.getElementById('describeBtn');
    const clickSound = document.getElementById('click-sound');
    const errorSound = document.getElementById('error-sound');

    // Accessibility (Speech)
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition, isListening = false;
    function speak(text) {
      if ('speechSynthesis' in window) {
        const u = new SpeechSynthesisUtterance(text);
        window.speechSynthesis.speak(u);
      }
      msg.textContent = text;
    }
    function playSound(type) {
      if (type === 'click') clickSound.play();
      if (type === 'error') errorSound.play();
    }

    // Game logic
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    function createDeck() {
      const d = [];
      for (const s of suits) for (const v of values) d.push({value:v, suit:s, faceUp:false});
      return d;
    }
    function deal() {
      deck = shuffle(createDeck());
      stock = [...deck];
      waste = [];
      foundations = [[],[],[],[]];
      tableau = [[],[],[],[],[],[],[]];
      score = 0;
      undosLeft = 5;
      gameInProgress = true;
      for (let i = 0; i < 7; i++) {
        for (let j = 0; j <= i; j++) {
          const card = stock.pop();
          card.faceUp = j === i;
          tableau[i].push(card);
        }
      }
      saveHistory();
      updateUI();
      speak("Game started. Say draw card, move card, undo, describe board, or help.");
    }

    function saveHistory() {
      if (history.length > 10) history.shift();
      history.push(JSON.stringify({stock, waste, foundations, tableau, score, undosLeft}));
    }
    function undo() {
      if (history.length <= 1 || undosLeft <= 0) {
        speak("No undos left.");
        playSound('error');
        return;
      }
      history.pop();
      const prev = JSON.parse(history[history.length-1]);
      stock = prev.stock;
      waste = prev.waste;
      foundations = prev.foundations;
      tableau = prev.tableau;
      score = prev.score;
      undosLeft = prev.undosLeft - 1;
      updateUI();
      speak(`Undone. ${undosLeft} undos left.`);
      playSound('click');
    }
    function drawCard() {
      if (stock.length > 0) {
        const card = stock.pop();
        card.faceUp = true;
        waste.push(card);
        score += 5;
        speak(`Drew ${card.value} of ${card.suit}.`);
        playSound('click');
      } else if (waste.length > 0) {
        stock = waste.reverse().map(c => {c.faceUp=false; return c;});
        waste = [];
        speak("Stock refilled.");
        playSound('click');
      } else {
        speak("Stock empty.");
        playSound('error');
      }
      saveHistory();
      updateUI();
    }
    function describeBoard() {
      let txt = `Score: ${score}. Undos: ${undosLeft}. `;
      txt += `Stock: ${stock.length} cards. `;
      txt += waste.length ? `Waste top: ${waste[waste.length-1].value} of ${waste[waste.length-1].suit}. ` : "Waste empty. ";
      for (let i=0;i<4;i++) {
        txt += foundations[i].length ? `Foundation ${i+1}: ${foundations[i][foundations[i].length-1].value} of ${foundations[i][foundations[i].length-1].suit}. ` : `Foundation ${i+1}: empty. `;
      }
      for (let i=0;i<7;i++) {
        let top = tableau[i].filter(c=>c.faceUp);
        txt += top.length ? `Tableau ${i+1} top: ${top[top.length-1].value} of ${top[top.length-1].suit}. ` : `Tableau ${i+1}: empty. `;
      }
      speak(txt);
    }
    function updateUI() {
      status.textContent = `Score: ${score} | Undos: ${undosLeft}`;
      status.classList.remove('hidden');
      boardEl.classList.remove('hidden');
      stockEl.textContent = `Stock: ${stock.length} card${stock.length===1?'':'s'}`;
      wasteEl.textContent = waste.length ? `Waste: ${waste[waste.length-1].value} of ${waste[waste.length-1].suit}` : 'Waste: empty';
      foundationsEl.textContent = foundations.map((f,i)=>f.length?`F${i+1}: ${f[f.length-1].value} of ${f[f.length-1].suit}`:`F${i+1}: empty`).join(' | ');
      tableauEl.textContent = tableau.map((t,i)=>{
        let up = t.filter(c=>c.faceUp);
        return up.length?`T${i+1}: ${up[up.length-1].value} of ${up[up.length-1].suit}`:`T${i+1}: empty`;
      }).join(' | ');
    }
    function resetGame() {
      gameInProgress = false;
      boardEl.classList.add('hidden');
      status.classList.add('hidden');
      msg.textContent = "Say 'start game' or tap Start.";
    }

    // Voice commands
    function processCommand(cmd) {
      cmd = cmd.toLowerCase();
      if (cmd.includes('start')) {
        deal();
      } else if (cmd.includes('draw')) {
        if (gameInProgress) drawCard(); else speak("Start game first.");
      } else if (cmd.includes('undo')) {
        if (gameInProgress) undo(); else speak("Start game first.");
      } else if (cmd.includes('describe')) {
        if (gameInProgress) describeBoard(); else speak("Start game first.");
      } else if (cmd.includes('help')) {
        speak("Say start game, draw card, move card, undo, describe board, save game, quit game.");
      } else if (cmd.includes('quit')) {
        resetGame();
        speak("Game ended.");
      } else {
        speak("Command not recognized. Say help.");
        playSound('error');
      }
    }

    // Speech recognition
    function startListening() {
      if (!SpeechRecognition) {
        speak("Voice control requires Chrome or Edge.");
        return;
      }
      if (!recognition) {
        recognition = new SpeechRecognition();
        recognition.lang = 'en-US';
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.onresult = (e) => {
          let transcript = e.results[0][0].transcript;
          processCommand(transcript);
          isListening = false;
          msg.textContent = "Say a command or tap a button.";
        };
        recognition.onerror = (e) => {
          speak("Speech error: " + e.error);
          isListening = false;
        };
        recognition.onstart = () => { isListening = true; msg.textContent = "Listening..."; };
        recognition.onend = () => { isListening = false; };
      }
      recognition.start();
    }

    // Button handlers
    startBtn.onclick = () => { deal(); };
    drawBtn.onclick = () => { if (gameInProgress) drawCard(); };
    undoBtn.onclick = () => { if (gameInProgress) undo(); };
    describeBtn.onclick = () => { if (gameInProgress) describeBoard(); };

    // Accessibility: tap anywhere, space/enter to start listening
    document.body.addEventListener('click', () => {
      if (!isListening) startListening();
    });
    document.body.addEventListener('keydown', (e) => {
      if ((e.key===' '||e.key==='Enter') && !isListening) startListening();
    });

    // On load
    window.onload = () => {
      resetGame();
      msg.textContent = "Say 'start game' or tap Start.";
    };
  </script>
</body>
</html>
